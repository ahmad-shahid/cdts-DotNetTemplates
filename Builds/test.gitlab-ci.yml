test_components:
  stage: test
  tags:
    - secrets
  before_script:
    - 'copy %SECRETS_PATH%\\GoC.WebTemplate.snk .'
  script:
    - 'dotnet test GoC.WebTemplate.Components.Tests --logger "junit;LogFilePath=ComponentsTestResults.xml"'
  after_script:
    - 'del GoC.WebTemplate.snk'
  artifacts:
    reports:
      junit: GoC.WebTemplate.Components.Tests\ComponentsTestResults.xml

test_components_core:
  stage: test
  tags:
    - secrets
  before_script:
    - 'copy %SECRETS_PATH%\\GoC.WebTemplate.snk .'
  script:
    - 'dotnet test GoC.WebTemplate.Components.Core.Tests --logger "junit;LogFilePath=ComponentsCoreTestResults.xml"'
  after_script:
    - 'del GoC.WebTemplate.snk'
  artifacts:
    reports:
      junit: GoC.WebTemplate.Components.Core.Tests\ComponentsCoreTestResults.xml

test_components_frame:
  stage: test
  dependencies:
    - build_sln
  script:
    - '"%xUNIT_PATH%\\xunit.console.exe" "%TEST_FRAME_PATH%\\GoC.WebTemplate.Components.Framework.Tests.dll" -junit ComponentsFrameworkTestResults.xml'
  artifacts:
    reports:
      junit: ComponentsFrameworkTestResults.xml


code_quality_samples:
  stage: test
  allow_failure: true
  tags:
    - nuget
    - msbuild
  before_script:
    - '"%NUGET_PATH%" restore %SAMPLES_SLN%'
  script:
    - '"%MSBUILD_PATH%" %SAMPLES_SLN% /p:RunCodeAnalysis=true /p:CodeAnalysisLogFile=SamplesCodeAnalysisReport.xml'
  except:
    - tags
    - master
  artifacts:    
    expire_in: 1 week
    paths: 
      - SampleCode\GoC.WebTemplate-MVC.Sample\SamplesCodeAnalysisReport.xml
      - SampleCode\GoC.WebTemplate-WebForms.Sample\SamplesCodeAnalysisReport.xml
